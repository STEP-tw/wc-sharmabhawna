extract logic from main
introduce new directory structure